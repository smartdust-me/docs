"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2847],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=i.createContext({}),d=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=d(e.components);return i.createElement(s.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=d(n),m=o,h=c["".concat(s,".").concat(m)]||c[m]||p[m]||a;return n?i.createElement(h,r(r({ref:t},u),{},{components:n})):i.createElement(h,r({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:o,r[1]=l;for(var d=2;d<a;d++)r[d]=n[d];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3014:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var i=n(7462),o=(n(7294),n(3905));const a={id:"automated-android-tests",title:"Automated tests (CI/CD) in Smartdust Lab"},r=void 0,l={unversionedId:"automated-android-tests",id:"automated-android-tests",title:"Automated tests (CI/CD) in Smartdust Lab",description:"The purpose of this tutorial is to demonstrate how Smartdust CLI client can be utilized in a typical CI/CD cycle of mobile app development.",source:"@site/docs/automated-android-tests-CICD.md",sourceDirName:".",slug:"/automated-android-tests",permalink:"/docs/docs/automated-android-tests",draft:!1,editUrl:"https://github.com/smartdust-me/docs/blob/main/docs/automated-android-tests-CICD.md",tags:[],version:"current",frontMatter:{id:"automated-android-tests",title:"Automated tests (CI/CD) in Smartdust Lab"},sidebar:"tutorialSidebar",previous:{title:"Connecting to devices remotely via REST API",permalink:"/docs/docs/REST API/api-remote-debug"},next:{title:"iOS Appium tests",permalink:"/docs/docs/ios-appium-tests"}},s={},d=[{value:"About Smartdust CLI client",id:"about-smartdust-cli-client",level:2},{value:"What we\u2019re going to do",id:"what-were-going-to-do",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installing and running Jenkins and Docker",id:"installing-and-running-jenkins-and-docker",level:2},{value:"Jenkins Pipeline creation",id:"jenkins-pipeline-creation",level:2},{value:"Prepare the Docker container for building and testing",id:"prepare-the-docker-container-for-building-and-testing",level:2},{value:"Edit your Jenkinsfile",id:"edit-your-jenkinsfile",level:2},{value:"Running the pipeline in Jenkins",id:"running-the-pipeline-in-jenkins",level:2}],u={toc:d},c="wrapper";function p(e){let{components:t,...a}=e;return(0,o.kt)(c,(0,i.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"The purpose of this tutorial is to demonstrate how ",(0,o.kt)("strong",{parentName:"p"},"Smartdust CLI client")," can be utilized in a typical CI/CD cycle of mobile app development."),(0,o.kt)("p",null,"The project described in this tutorial is available on ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/jordus100/jenkins-example"},"Github"),"."),(0,o.kt)("h2",{id:"about-smartdust-cli-client"},"About Smartdust CLI client"),(0,o.kt)("p",null,"Smartdust CLI client is a tool that provides a command line (non-graphical) interface to connect to devices in a Smartdust Lab.\nMore specifically, it works analogously to the \u201cRemote Debug\u201d functionality on Device Dashboard (see picture below) to connect to a device via ADB, but does so automatically."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Remote Debug screenshot",src:n(6569).Z,width:"645",height:"167"})),(0,o.kt)("p",null,"That means, it can be easily used for connecting to devices automatically in scripts and, for example, automatic testing pipelines can be created.\nTo familiarize yourself with the tool, please refer to ",(0,o.kt)("a",{parentName:"p",href:"./cli-client.md"},"its documentation"),". "),(0,o.kt)("h2",{id:"what-were-going-to-do"},"What we\u2019re going to do"),(0,o.kt)("p",null,"In this tutorial, the popular CI/CD platform ",(0,o.kt)("strong",{parentName:"p"},"Jenkins")," will be utilized for creating a build-test pipeline for a mobile app.\nThe testing part will use the Smartdust CLI client to connect to devices on a Smartdust Lab instance and execute instrumentation tests on them.\nIn terms of architecture, only one server running Jenkins and Docker will be used. A handy Docker container built for Android development will serve as our building environment: ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/mingc/android-build-box/"},"https://hub.docker.com/r/mingc/android-build-box/"),".\nTo use it for test execution, integrating the Smartdust CLI client into the container will be necessary."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Machine running a modern Linux OS")),(0,o.kt)("h2",{id:"installing-and-running-jenkins-and-docker"},"Installing and running Jenkins and Docker"),(0,o.kt)("p",null,"Install Docker in your OS following the relevant instructions:",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/"},"https://docs.docker.com/engine/install/")),(0,o.kt)("p",null,"Follow the official Jenkins documentation to install it on your machine of choice:",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("a",{parentName:"p",href:"https://www.jenkins.io/doc/book/installing/linux/"},"https://www.jenkins.io/doc/book/installing/linux/"),". Then follow the instructions to get Jenkins up and running.\nIn most cases, you should be able to reach the Jenkins web interface from your web browser at the address: ",(0,o.kt)("inlineCode",{parentName:"p"},"[MACHINE_IP_ADDRESS]:8080"),".\nIf you access Jenkins from the same machine, that will be ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:8080"),". Go through the initialization wizard.\nIf something goes wrong at that point, look into the official Jenkins docs or other available online resources."),(0,o.kt)("h2",{id:"jenkins-pipeline-creation"},"Jenkins Pipeline creation"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'In the main Dashboard in the jenkins web interface select "New item". A creation wizard will appear.')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},'Enter the name of your project, e.g "smart pipe". Select the "Pipeline" type of item.\nA configuration page will be displayed. If not, enter your newly created Pipeline and select "Configure" from the menu on the left.\n',(0,o.kt)("img",{alt:"Configuration Page",src:n(2850).Z,width:"1324",height:"836"})))),(0,o.kt)("p",null,"You can chose your own app if you know what you;re doing beacuse it might require some manual adjustments to the configuration of both Pipeline and you app."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Set "Script Path" to "Jenkinsfile" (or your custom location if you use your own app).')),(0,o.kt)("h2",{id:"prepare-the-docker-container-for-building-and-testing"},"Prepare the Docker container for building and testing"),(0,o.kt)("p",null,"As previously mentioned a ready-made container for Android development will be used - ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/mingc/android-build-box/"},"https://hub.docker.com/r/mingc/android-build-box/"),".\nHowever, we do need to modify it to include the Smartdust CLI client and its configuration in it."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Enter your terminal")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Download the container:",(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("inlineCode",{parentName:"p"},"docker pull mingc/android-build-box"),"\n")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Enter the container's terminal:",(0,o.kt)("br",{parentName:"p"}),"\n","",(0,o.kt)("inlineCode",{parentName:"p"},"docker run --user root -it mingc/android-build-box bash -l")))),(0,o.kt)("p",null,"Now, ",(0,o.kt)("u",null,"staying in the virtual machine's terminal"),", follow the instructions of installing and using the Smartdust CLI client from ",(0,o.kt)("a",{parentName:"p",href:"./cli-client.md"},"its documentation"),".\nCreate your access token in your Smartdust Lab and make a test connection via the tool as described in the tutorial.\nAdd the ADB key when prompted in the Smartdust Lab web interface during making the first connection.\nThat will be your docker container\u2019s ADB key."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Right after all of the above steps, you need to exit your docker container ",(0,o.kt)("u",null,"without killing it")," OR open another terminal tab.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Run \u201cdocker ps\u201d command to check if your container is still running. It should look something like this:\n",(0,o.kt)("img",{alt:"docker ps output",src:n(8212).Z,width:"1434",height:"50"}))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Copy the ",(0,o.kt)("inlineCode",{parentName:"p"},"CONTAINER ID")," field (leftmost)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Save the Docker container\u2019s state under a new name, e.g.\ndocker commit ",(0,o.kt)("inlineCode",{parentName:"p"},"[CONTAINER ID] mingc/android-build-box-smartdust")))),(0,o.kt)("p",null,"Congratulations!\nNow we\u2019ve customized a Docker container to our own needs.\nWell actually, the more proper way to do it would be to modify its Dockerfile and build it all over again but this is good enough for now."),(0,o.kt)("h2",{id:"edit-your-jenkinsfile"},"Edit your Jenkinsfile"),(0,o.kt)("p",null,"Jenkinsfile is a file type used for defining Pipelines in Jenkins.\nFor more info see: ",(0,o.kt)("a",{parentName:"p",href:"https://www.jenkins.io/doc/book/pipeline/jenkinsfile/"},"https://www.jenkins.io/doc/book/pipeline/jenkinsfile/"),". "),(0,o.kt)("p",null,"The Jenkinsfile showed here and available ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/jordus100/jenkins-example/blob/main/Jenkinsfile"},"on Github")," is supposed to serve as starting point for extension for your own usage.\nHowever, you might want to use a completely different configuration, there are lots of possibilities."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"pipeline file",src:n(9446).Z,width:"1318",height:"1600"})),(0,o.kt)("p",null,"Don\u2019t forget to change the ",(0,o.kt)("inlineCode",{parentName:"p"},"SD_URL")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"SD_TOKEN")," environment variables (lines 39-40) to your own!"),(0,o.kt)("p",null,"Jenkins Pipeline steps work in such a way that all the project files generated e.g. executables are moved to the agent used in the next stage.\nThis file resides in the project\u2019s git repository and in my case in the top directory.\nYou may have/want to configure some things in the mingc/android-build-box Docker container. Read the instructions at ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/mingc/android-build-box/"},"https://hub.docker.com/r/mingc/android-build-box/"),".\nThe things that you might have to change include:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Changing the java version - like in line 26")),(0,o.kt)("h2",{id:"running-the-pipeline-in-jenkins"},"Running the pipeline in Jenkins"),(0,o.kt)("p",null,"From the main dashboard, click on the name of your pipeline.\nThen, in the left side menu click on \u201cBuild\u201d.\nThe execution progress bar should start moving.\nIt takes a while, about 5 minutes.\nIn case of errors, read the console output logs.\nThere might be something to correct in your Gradle and Android project configuration or in the settings of the Docker container."))}p.isMDXComponent=!0},8212:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/docker_ps-4dfc901ea8f56af9391be20ad22e953d.png"},2850:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/jenkins_conf-6a027e01d2b56d6cad03b4fe1b5c6790.png"},9446:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/pipeline_file-70540ecefcebad70eacb00f9e68236bc.png"},6569:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/remote_debug-75b1e123b9251310ad0d7f6316431d92.png"}}]);