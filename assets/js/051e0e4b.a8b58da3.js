"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4626],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),p=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||i;return n?o.createElement(h,a(a({ref:t},c),{},{components:n})):o.createElement(h,a({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:r,a[1]=s;for(var p=2;p<i;p++)a[p]=n[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4255:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var o=n(7462),r=(n(7294),n(3905));const i={id:"api-remote-debug",title:"Connecting to devices remotely via REST API",sidebar_position:1},a="Connecting to devices remotely via REST API",s={unversionedId:"REST API/api-remote-debug",id:"REST API/api-remote-debug",title:"Connecting to devices remotely via REST API",description:"The SmartDust Lab REST API allows you to connect to devices remotely.",source:"@site/docs/REST API/remote-debug.md",sourceDirName:"REST API",slug:"/REST API/api-remote-debug",permalink:"/docs/docs/REST API/api-remote-debug",draft:!1,editUrl:"https://github.com/smartdust-me/docs/blob/main/docs/REST API/remote-debug.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"api-remote-debug",title:"Connecting to devices remotely via REST API",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"SmartDust Lab REST API access",permalink:"/docs/docs/REST API/api-access"},next:{title:"iOS Appium tests",permalink:"/docs/docs/ios-appium-tests"}},l={},p=[{value:"Steps to connect",id:"steps-to-connect",level:2},{value:"Steps to disconnect",id:"steps-to-disconnect",level:2},{value:"Tips",id:"tips",level:2}],c={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"connecting-to-devices-remotely-via-rest-api"},"Connecting to devices remotely via REST API"),(0,r.kt)("p",null,"The SmartDust Lab REST API allows you to connect to devices remotely.\nThis is particularly useful for automating tasks and integrating with other systems."),(0,r.kt)("p",null,"If you are unfamiliar with the REST API, please refer to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/docs/REST%20API/api-access"},"API access documentation")," for more information."),(0,r.kt)("h2",{id:"steps-to-connect"},"Steps to connect"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Pick a free device from the SmartDust Lab.")),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"GET /api/v1/devices")," endpoint to retrieve a list of available devices.\nTo view the available, unused devices, you should filter the device objects to have the following values:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "present": true,\n  "status": 3,\n  "ready": true,\n  "using": false\n}\n')),(0,r.kt)("p",null,"Store the ",(0,r.kt)("inlineCode",{parentName:"p"},"serial")," field values of the devices you choose to connect to."),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Put the device under your control.")),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"POST /api/v1/user/devices")," endpoint to take control of the chosen device.\nInclude the chosen device's serial identifier in the request body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "serial": "serial_number"\n}\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Start a Remote Debug session.")),(0,r.kt)("p",null,"Send a POST request to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/v1/user/devices/{serial}/remoteConnect")," endpoint.\nReplace ",(0,r.kt)("inlineCode",{parentName:"p"},"{serial}")," with the serial number of the device you want to connect to.\nThe response object will contain a ",(0,r.kt)("inlineCode",{parentName:"p"},"remoteDebugUrl")," field, from which you should export the port number by splitting the URL string by ",(0,r.kt)("inlineCode",{parentName:"p"},":"),"."),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Find out the device's provider information.")),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"GET /api/v1/user/devices/{serial}")," endpoint to retrieve a specific device's information.\nExtract the ",(0,r.kt)("inlineCode",{parentName:"p"},"ip")," field from the ",(0,r.kt)("inlineCode",{parentName:"p"},"provider")," object in the response JSON."),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Open a tunnel to the device's provider server.")),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"POST api/v1/tunnel")," endpoint to open a tunnel to the device's provider server.\nPut the variables saved in previous steps in request body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "ip": "provider_ip",\n    "port": "remote_debug_port"\n}\n')),(0,r.kt)("p",null,"The response will contain a ",(0,r.kt)("inlineCode",{parentName:"p"},"port")," field, which should be saved."),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Connect to the device via ADB (Android) or ",(0,r.kt)("inlineCode",{parentName:"li"},"sd_remoteios")," (iOS).")),(0,r.kt)("p",null,"The Remote Debug address for the device is ",(0,r.kt)("inlineCode",{parentName:"p"},"[your_instance_name].smartdust.me:[port]"),", where ",(0,r.kt)("inlineCode",{parentName:"p"},"[port]")," is the port number you received in the previous step."),(0,r.kt)("p",null,"If it's the first time your machine is connecting to an Android device, you have open the SmartDust Lab web interface first and accept the key fingerprint when connecting."),(0,r.kt)("h2",{id:"steps-to-disconnect"},"Steps to disconnect"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Close the tunnel to the device's provider.")),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE /api/v1/tunnel")," endpoint to close the tunnel to the device's provider server.\nProvide the same information in the body as when creating the tunnel."),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Stop the Remote Debug session.")),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE /api/v1/user/devices/{serial}/remoteConnect")," endpoint to stop the Remote Debug session."),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Release the device.")),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE /api/v1/user/devices/{serial}")," endpoint to release the device from control."),(0,r.kt)("h2",{id:"tips"},"Tips"),(0,r.kt)("p",null,"Refer to the Swagger documentation for the API for more information, which is available at ",(0,r.kt)("inlineCode",{parentName:"p"},"https://[your-instance-name].smartdust.me/api/v1/swagger.json"),"."),(0,r.kt)("p",null,'When you put the device under control through the API, you should see it in the web interface of the SmartDust Lab.\nThe device is then marked as "Automation".'),(0,r.kt)("p",null,"For automation use cases, such as CI/CD pipelines, you need to make sure to reuse a previously manually accepted ADB key, otherwise the connection will be rejected.\nOn Linux, the ADB key is stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.android/adbkey"),".\nIt needs to be copied to the machine where the automation is running."))}u.isMDXComponent=!0}}]);