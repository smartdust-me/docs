"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4626],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return n?o.createElement(h,a(a({ref:t},p),{},{components:n})):o.createElement(h,a({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,a=new Array(i);a[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,a[1]=l;for(var c=2;c<i;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4255:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var o=n(7462),r=(n(7294),n(3905));const i={id:"api-remote-debug",title:"Connecting to devices remotely via REST API",sidebar_position:1},a="Connecting to devices remotely via REST API",l={unversionedId:"REST API/api-remote-debug",id:"REST API/api-remote-debug",title:"Connecting to devices remotely via REST API",description:"The SmartDust Lab REST API allows you to connect to devices remotely.",source:"@site/docs/REST API/remote-debug.md",sourceDirName:"REST API",slug:"/REST API/api-remote-debug",permalink:"/docs/REST API/api-remote-debug",draft:!1,editUrl:"https://github.com/smartdust-me/docs/blob/main/docs/REST API/remote-debug.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"api-remote-debug",title:"Connecting to devices remotely via REST API",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"SmartDust Lab REST API access",permalink:"/docs/REST API/api-access"},next:{title:"Parallel testing Android apps using a remote testing platform and Appium",permalink:"/docs/android-appium-parallel"}},s={},c=[{value:"Steps to connect",id:"steps-to-connect",level:2},{value:"Steps to disconnect",id:"steps-to-disconnect",level:2},{value:"Tips",id:"tips",level:2}],p={toc:c},u="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"connecting-to-devices-remotely-via-rest-api"},"Connecting to devices remotely via REST API"),(0,r.kt)("p",null,"The SmartDust Lab REST API allows you to connect to devices remotely.\nThis is particularly useful for automating tasks and integrating with other systems."),(0,r.kt)("p",null,"If you are unfamiliar with the REST API, please refer to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/REST%20API/api-access"},"API access documentation")," for more information."),(0,r.kt)("h2",{id:"steps-to-connect"},"Steps to connect"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Pick a free device from the SmartDust Lab.")),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"GET /api/v1/devices")," endpoint to retrieve a list of available devices.\nTo view the available, unused devices, you should filter the device objects to have the following values:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "present": true,\n  "status": 3,\n  "ready": true,\n  "using": false\n}\n')),(0,r.kt)("p",null,"Store the ",(0,r.kt)("inlineCode",{parentName:"p"},"serial")," field values of the devices you choose to connect to."),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Put the device under your control.")),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"POST /api/v1/user/devices")," endpoint to take control of the chosen device.\nInclude the chosen device's serial identifier in the request body:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "serial": "serial_number"\n}\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Start a Remote Debug session.")),(0,r.kt)("p",null,"Send a POST request to the ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/v1/user/devices/{serial}/remoteConnectTunnel")," endpoint.\nReplace ",(0,r.kt)("inlineCode",{parentName:"p"},"{serial}")," with the serial number of the device you want to connect to."),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Connect to the device via ADB (Android) or ",(0,r.kt)("inlineCode",{parentName:"li"},"usbfluxctl")," (iOS).")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Android:")),(0,r.kt)("p",null,"Use Android Debug Bridge which comes with the Android SDK.\nRun the following command to connect to the device:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"adb connect [remoteConnectUrl]\n")),(0,r.kt)("p",null,"where ",(0,r.kt)("inlineCode",{parentName:"p"},"[remoteConnectUrl]")," is the value returned in the API response from the previous step."),(0,r.kt)("p",null,"If it's the first time your machine is connecting to an Android device, you have open the SmartDust Lab web interface first and accept the key fingerprint when connecting."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"iOS:")),(0,r.kt)("p",null,"Only Linux and MacOS are supported for iOS Remote Debugging for the time being.\nFollow the instructions in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/ios-remote-debug"},"iOS Remote Debugging documentation")," to install ",(0,r.kt)("inlineCode",{parentName:"p"},"usbfluxd")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"usbfluxctl"),".\nRun the following command to connect to the device:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo usbfluxd -n && usbfluxctl add [remoteConnectUrl]\n")),(0,r.kt)("p",null,"where ",(0,r.kt)("inlineCode",{parentName:"p"},"[remoteConnectUrl]")," is the value returned in the API response from the previous step."),(0,r.kt)("h2",{id:"steps-to-disconnect"},"Steps to disconnect"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Close the connection to the device.")),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE /api/v1/user/devices/{serial}/remoteConnectTunnel")," endpoint."),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Release the device.")),(0,r.kt)("p",null,"Call the ",(0,r.kt)("inlineCode",{parentName:"p"},"DELETE /api/v1/user/devices/{serial}")," endpoint to release the device from your control."),(0,r.kt)("h2",{id:"tips"},"Tips"),(0,r.kt)("p",null,"Refer to the Swagger documentation for the API for more information, which is available at ",(0,r.kt)("inlineCode",{parentName:"p"},"https://[your-instance-name].smartdust.me/api/v1/swagger.json"),"."),(0,r.kt)("p",null,'When you put the device under control through the API, you should see it in the web interface of the SmartDust Lab.\nThe device is then marked as "Automation".'),(0,r.kt)("p",null,"For automation use cases, such as CI/CD pipelines, you need to make sure to reuse a previously manually accepted ADB key, otherwise the connection will be rejected.\nOn Linux, the ADB key is stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.android/adbkey"),".\nIt needs to be copied to the machine where the automation is running."))}d.isMDXComponent=!0}}]);