<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-ios-appium">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">iOS CI-CD pipeline with Jenkins and Appium | Smartdust Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://smartdust-me.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://smartdust-me.github.io/docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://smartdust-me.github.io/docs/docs/ios-appium"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="iOS CI-CD pipeline with Jenkins and Appium | Smartdust Docs"><meta data-rh="true" name="description" content="Simple example of what&#x27;s needed to set up and run a CI-CD pipeline of an iOS application with Smartdust Lab."><meta data-rh="true" property="og:description" content="Simple example of what&#x27;s needed to set up and run a CI-CD pipeline of an iOS application with Smartdust Lab."><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://smartdust-me.github.io/docs/docs/ios-appium"><link data-rh="true" rel="alternate" href="https://smartdust-me.github.io/docs/docs/ios-appium" hreflang="en"><link data-rh="true" rel="alternate" href="https://smartdust-me.github.io/docs/docs/ios-appium" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/docs/blog/rss.xml" title="Smartdust Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docs/blog/atom.xml" title="Smartdust Docs Atom Feed"><link rel="stylesheet" href="/docs/assets/css/styles.19b7e1c8.css">
<link rel="preload" href="/docs/assets/js/runtime~main.54119f74.js" as="script">
<link rel="preload" href="/docs/assets/js/main.ecb381ad.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/docs/cli-client">Tutorial</a><a class="navbar__item navbar__link" href="/docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/cli-client">Smartdust CLI Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/docs/ios-appium">iOS CI-CD pipeline with Jenkins and Appium</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/libimobiledevice">Libimobiledevice installation guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/docs/sd_remoteios">sd_remoteios - iOS Remote Connect tool</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">iOS CI-CD pipeline with Jenkins and Appium</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>iOS CI-CD pipeline with Jenkins and Appium</h1><p>Simple example of what&#x27;s needed to set up and run a CI-CD pipeline of an iOS application with Smartdust Lab. <br>
The pipeline involves: </p><ul><li>building the app from source,</li><li>connecting to iOS devices on a Smartdust Lab instance,</li><li>installing the built app package on the connected test devices,</li><li>running an Appium server on Linux and connecting it to the iPhones,</li><li>running an Appium test on test devices using a standard webdriverio Javascript client.</li></ul><p>All project files are available in a Github <a href="https://github.com/jordus100/ios-example" target="_blank" rel="noopener noreferrer">repository</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">â€‹</a></h2><ul><li>Mac OS machine </li><li>Apple Developer account (active)</li><li>Linux machine with preferably Ubuntu (technically you could do everything on the Mac, but we split responsibilities in this example)</li><li>Being comfortable using Unix-like OS (command line, resolving issues)</li></ul><h1>Setting up iOS project on Mac (XCode, Fastlane)</h1><p>First, you need to make sure your project in XCode builds and runs on simulators without any issues.</p><p>Then, you need to use the <code>sd_remoteios</code> tool from Smartdust to connect to iOS devices.
Follow the instructions from <a href="/docs/docs/sd_remoteios">its documentation</a>.</p><p>You should be able to select iOS devices from the Smartdust Lab instance in XCode to run your app on them.
Check if that works. You need to resolve any code signing issues that may arise.
<strong>Test-run your application on each and every device that you want to use for testing.</strong>
For simplicity&#x27;s sake I used only automatic code signing and development builds in this example.
You might be in need of a more advanced setup.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fastlane">Fastlane<a href="#fastlane" class="hash-link" aria-label="Direct link to Fastlane" title="Direct link to Fastlane">â€‹</a></h3><p>Fastlane is a widely popular tool facilitating iOS building and deployment processes.
Download and get it running with the help of the <a href="https://docs.fastlane.tools/" target="_blank" rel="noopener noreferrer">official docs</a>.
You need to install Ruby for Fastlane to work and please use Ruby version manager, <a href="https://github.com/rbenv/rbenv" target="_blank" rel="noopener noreferrer">rbenv</a>
for that. It will make things much easier down the road.
I use fastlane only for building the app, nothing fancy. Here is my configuration file (<em>fastfile</em>):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">default_platform(:ios)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">platform :ios do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  desc &quot;Simple build&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lane :build do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unlock_keychain(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      path:&quot;~/Library/Keychains/login.keychain-db&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      password:&quot;smart1986&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gym(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      xcargs:&quot;-allowProvisioningUpdates&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      configuration:&quot;Debug&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      export_method:&quot;development&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you can see, I define only one <em>lane</em>.
The <code>unlock_keychain</code> action is necessary for running the builds via an SSH connection.
Otherwise, the certificates needed for codesigning are locked and building fails.
Your keychain <code>path</code> may be different, you need to look where the keychain with your codesigning certificates is.
You can view the certificates via the &quot;Keychain&quot; application.</p><p>The <code>gym</code> command just builds the app. </p><p>The goal here is to be able to build your app via an SSH connection and running only one command in your project directory:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bundle exec fastlane build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where <code>build</code> is the lane name I chose.</p><p>After everything, upload your project to an online Git repository, if you haven&#x27;t already.</p><h1>Setting up Jenkins server</h1><p>I use a Linux machine for this part, however a Mac or even Windows should work too - you may need to make some adjustments.
Download and run the all-popular CI-CD automation software - <a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a>.
After you have the server up and running, head to the web interface dashboard. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-the-mac-machine-as-a-slave-node">Adding the Mac machine as a slave node<a href="#adding-the-mac-machine-as-a-slave-node" class="hash-link" aria-label="Direct link to Adding the Mac machine as a slave node" title="Direct link to Adding the Mac machine as a slave node">â€‹</a></h3><p>You need to add the Mac machine that we set up in the earlier step as a Jenkins slave node.
Go to <code>Manage Jenkins -&gt; Nodes -&gt; New Node</code> and go through the wizard.
It&#x27;s pretty straighforward given you have an SSH server already set up on your Mac.
If in trouble, there is plenty of online tutorials on how to do that.
The objective is to have your Mac machine displayed as available in the <code>Nodes</code> list on Jenkins.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-pipeline">Creating a pipeline<a href="#creating-a-pipeline" class="hash-link" aria-label="Direct link to Creating a pipeline" title="Direct link to Creating a pipeline">â€‹</a></h3><p>Now go ahead and create a Jenkins pipeline through the web interface - <code>Dashboard -&gt; New item -&gt; Pipeline</code>.
The configuration should be standard.
Set the Pipeline definition to <code>Pipeline script from SCM.</code> Enter your project repository credentials.
Put <code>Jekinsfile</code> in the <code>Script path</code> option.
My config looks like this:
<img loading="lazy" src="/docs/assets/images/pipeline-config-25a427bfec095a42026da75804b4b3bc.png" width="1060" height="1778" class="img_ev3q"></p><h1>Setting up CI-CD tools</h1><p>We need a computer to connect to iOS devices on Smartdust Lab, install the application on them and run Appium test.
We could set up another Jenkins slave node, but for simplicity I decided to go against best practices and use the &quot;built-in&quot;
Jenkins node - the same machine on which the server is running.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="libimobiledevice-tools">Libimobiledevice tools<a href="#libimobiledevice-tools" class="hash-link" aria-label="Direct link to Libimobiledevice tools" title="Direct link to Libimobiledevice tools">â€‹</a></h3><p>Install <code>libimobiledevice</code> using the <a href="/docs/docs/libimobiledevice">instructions</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="smartdust-cli-client">Smartdust CLI client<a href="#smartdust-cli-client" class="hash-link" aria-label="Direct link to Smartdust CLI client" title="Direct link to Smartdust CLI client">â€‹</a></h3><p>Download, install and test run the Smartdust CLI client according to our <a href="/docs/docs/cli-client">tutorial</a>.
It will enable Jenkins to headlessly connect to test devices.</p><p>You should be able to list connected iOS devices by calling <code>idevice_id -l</code> (from <code>libimobiledevice</code> toolchain).
After that, check if <code>ideviceinstaller</code> works by installing your .ipa app on an iPhone connected via the Smartdust CLI client.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nodejs-for-appium">Node.js (for Appium)<a href="#nodejs-for-appium" class="hash-link" aria-label="Direct link to Node.js (for Appium)" title="Direct link to Node.js (for Appium)">â€‹</a></h3><p>We will need to get Node installed for running the Appium server (and client in our case).
Please use Node Version Manager <a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener noreferrer">nvm</a> for this. I recommend Node LTS version 18.16.1.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="go-ios-toolchain">go-ios toolchain<a href="#go-ios-toolchain" class="hash-link" aria-label="Direct link to go-ios toolchain" title="Direct link to go-ios toolchain">â€‹</a></h3><p>Another iOS toolchain that we&#x27;ll use: <a href="https://github.com/danielpaulus/go-ios" target="_blank" rel="noopener noreferrer">repo</a>. Install it via npm:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install -g go-ios</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Creating pipeline script</h1><p>Create a file called <code>Jenkinsfile</code> in the home directory of your project.
This is an example of this file for this project:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Build app&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            agent { label &#x27;mac&#x27; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PATH=&quot;/Users/smartdust/.rbenv/shims:/usr/bin:/bin:/usr/sbin:/sbin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                checkout scm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;gem install bundler&#x27; //fastlane setup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;bundle install&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;bundle exec fastlane build&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                stash includes: &#x27;Kalculator.ipa&#x27;, name: &#x27;BUILT_IPA&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Connect to iPhones&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            agent { label &#x27;inbuilt&#x27; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SD_URL = &#x27;https://staging.smartdust.me&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SD_TOKEN = &#x27;a534c80c572442689dd560c4bc34921ce441781b34434f5bb02b062424a89fee&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;smartdust-client disconnect --all&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;smartdust-client connect --all -f platform:iOS&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Install app on iPhones&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            agent { label &#x27;inbuilt&#x27; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                APP_PATH = &#x27;Kalculator.ipa&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                unstash &#x27;BUILT_IPA&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;ideviceinstaller -u c81fadec2a2affb46093bb3036cf1f49db2dc187 install $APP_PATH&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;ideviceinstaller -u 25c925bfbb0ed425fa7c4e30d62b6be82fe15298 install $APP_PATH&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Appium test&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            agent { label &#x27;inbuilt&#x27; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PATH = &#x27;/home/smartdust/.nvm/versions/node/v18.16.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SD_URL = &#x27;https://staging.smartdust.me&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SD_TOKEN = &#x27;a534c80c572442689dd560c4bc34921ce441781b34434f5bb02b062424a89fee&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dir(&#x27;client&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sh &#x27;npm install&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sh &#x27;npx appium &amp;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sh &#x27;ios --udid=25c925bfbb0ed425fa7c4e30d62b6be82fe15298 forward 7777 8100&amp;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sh &#x27;ios --udid=c81fadec2a2affb46093bb3036cf1f49db2dc187 forward 7778 8100&amp;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sh &#x27;sleep 10&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    sh &#x27;node test.js&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;smartdust-client disconnect --all&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Change the agent labels to match your Jenkins nodes config</li><li>Change SD_URL and SD_TOKEN variables to your own</li><li>The PATH environment variables being set uses a bit dirty trick that points to a version of Ruby and Node installed by <code>rbenv</code> and <code>nvm</code>.</li><li>Note that when I call <code>smartdust-client</code>, I use the <code>--all</code> flag.<br>The reason is that in my case, all iPhones on my Smartdust Lab instance are connected to the same provider, so this is fine.
You wouldn&#x27;t be able to connect to all devices if they were connected via different providers,
the tool would try for a long time and fail.</li></ul><h1>Appium test</h1><p>The last stage of the pipeline above is an Appium test.
It&#x27;s a Node project in a subfolder &quot;client&quot; in my project repository. You can go ahead and copy it.
It declares dependencies on Appium and XCUITest iOS driver.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">â€‹</a></h3><p>Appium server communicates with iOS devices using a proxy app called <a href="https://github.com/facebookarchive/WebDriverAgent" target="_blank" rel="noopener noreferrer">WebDriverAgent</a>.
It runs an infinite XCUITest (iOS test framework) test case on the device and listens to WebDriver commands in W3C specification format.
Then it translates WebDriver commands to native XC Test commands and runs them on the device.
We need to forward each device&#x27;s WDA port to a localhost port for communication.
This is executed via the go-ios tool in lines 34 and 35 of my Jenkinsfile.</p><p>I recommend doing all pipeline steps manually to make sure everything works.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="appium-client-code">Appium client code<a href="#appium-client-code" class="hash-link" aria-label="Direct link to Appium client code" title="Direct link to Appium client code">â€‹</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const wdio = require(&quot;webdriverio&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const sharedCapabilities = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;appium:automationName&#x27;: &#x27;XCUITest&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;platformName&#x27;: &#x27;iOS&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;appium:usePrebuiltWDA&#x27;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const devicesCapabilities = [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;appium:udid&#x27;: &#x27;25c925bfbb0ed425fa7c4e30d62b6be82fe15298&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;appium:webDriverAgentUrl&#x27;: &#x27;http://localhost:7777&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;appium:udid&#x27;: &#x27;c81fadec2a2affb46093bb3036cf1f49db2dc187&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;appium:webDriverAgentUrl&#x27;: &#x27;http://localhost:7778&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const opts = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path: &#x27;/&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port: 4723,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //maxInstances: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async function main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clients = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(i=0; i&lt;devicesCapabilities.length; i++){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        opts.capabilities = {...sharedCapabilities, ...devicesCapabilities[i]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clients[i] = await wdio.remote(opts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (const client of clients) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await client.activateApp(&quot;jog.Kalculator&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const elem = await client.$(&#x27;~clearButton&#x27;) // accessibility ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await elem.click()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client.pause(2000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await elem.click()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await client.deleteSession()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are other Appium WebDriver clients in other programming languages, they work analogously.</p><p>For explanation of each capability, visit the XCUITest driver <a href="https://appium.github.io/appium-xcuitest-driver/4.32/" target="_blank" rel="noopener noreferrer">documentation website</a>.</p><p>Note that in this example an element is located using its accessibility ID.
This is great as this type of reference doesn&#x27;t change with localization, but what&#x27;s even more important
is that you can assign accessibility IDs in Android apps as well. In result, you can write <strong>cross-platform tests</strong> which
saves you time and hassle.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="important-notes-regarding-appium-tests">Important notes regarding Appium tests<a href="#important-notes-regarding-appium-tests" class="hash-link" aria-label="Direct link to Important notes regarding Appium tests" title="Direct link to Important notes regarding Appium tests">â€‹</a></h3><ul><li>Your tests may fail if there is a system overlay pop-up currently displaying on top of everything.
E.g. &quot;Log in to Apple ID&quot;.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ios-appium.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/docs/cli-client"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Smartdust CLI Client</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/docs/libimobiledevice"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Libimobiledevice installation guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#fastlane" class="table-of-contents__link toc-highlight">Fastlane</a></li><li><a href="#adding-the-mac-machine-as-a-slave-node" class="table-of-contents__link toc-highlight">Adding the Mac machine as a slave node</a></li><li><a href="#creating-a-pipeline" class="table-of-contents__link toc-highlight">Creating a pipeline</a></li><li><a href="#libimobiledevice-tools" class="table-of-contents__link toc-highlight">Libimobiledevice tools</a></li><li><a href="#smartdust-cli-client" class="table-of-contents__link toc-highlight">Smartdust CLI client</a></li><li><a href="#nodejs-for-appium" class="table-of-contents__link toc-highlight">Node.js (for Appium)</a></li><li><a href="#go-ios-toolchain" class="table-of-contents__link toc-highlight">go-ios toolchain</a></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#appium-client-code" class="table-of-contents__link toc-highlight">Appium client code</a></li><li><a href="#important-notes-regarding-appium-tests" class="table-of-contents__link toc-highlight">Important notes regarding Appium tests</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.54119f74.js"></script>
<script src="/docs/assets/js/main.ecb381ad.js"></script>
</body>
</html>